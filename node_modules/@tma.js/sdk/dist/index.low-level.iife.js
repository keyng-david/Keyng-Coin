var Xe=Object.defineProperty;var ze=(i,f,l)=>f in i?Xe(i,f,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[f]=l;var P=(i,f,l)=>(ze(i,typeof f!="symbol"?f+"":f,l),l);this.tmajs=this.tmajs||{};this.tmajs.sdk=function(i){"use strict";function f(t,e){let n;const r=()=>{n!==void 0&&e&&e(n),n=void 0};return[()=>n===void 0?n=t(r):n,r]}function l(t){const e=R(),{count:n}=e;e.unsubscribe(t),n&&!e.count&&ye()}function U(t){return R().subscribe(t),()=>l(t)}class re{constructor(e,n={}){this.scope=e,this.options=n}print(e,...n){const r=new Date,o=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(r),{textColor:s,bgColor:u}=this.options,c="font-weight: bold;padding: 0 5px;border-radius:5px";console[e](`%c${o}%c / %c${this.scope}`,`${c};background-color: lightblue;color:black`,"",`${c};${s?`color:${s};`:""}${u?`background-color:${u}`:""}`,...n)}error(...e){this.print("error",...e)}log(...e){this.print("log",...e)}}const A=new re("SDK",{bgColor:"forestgreen",textColor:"white"});let S=!1;const L=({name:t,payload:e})=>{A.log("Event received:",e?{name:t,payload:e}:{name:t})};function oe(t){S!==t&&(S=t,t?U(L):l(L))}function ie(...t){S&&A.log(...t)}class W{constructor(){P(this,"listeners",new Map);P(this,"listenersCount",0);P(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(e,...n){this.subscribeListeners.forEach(o=>o({event:e,args:n})),(this.listeners.get(e)||[]).forEach(([o,s])=>{o(...n),s&&this.off(e,o)})}on(e,n,r){let o=this.listeners.get(e);return o||this.listeners.set(e,o=[]),o.push([n,r]),this.listenersCount+=1,()=>this.off(e,n)}off(e,n){const r=this.listeners.get(e)||[];for(let o=0;o<r.length;o+=1)if(n===r[o][0]){r.splice(o,1),this.listenersCount-=1;return}}subscribe(e){return this.subscribeListeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){for(let n=0;n<this.subscribeListeners.length;n+=1)if(this.subscribeListeners[n]===e){this.subscribeListeners.splice(n,1);return}}}function V(t,e,n){return window.addEventListener(t,e,n),()=>window.removeEventListener(t,e,n)}function C(...t){let e=!1;const n=[...t];return[r=>!e&&n.push(r),()=>{e||(e=!0,n.forEach(r=>r()))},e]}class E extends Error{constructor(e,n,r){super(n,{cause:r}),this.type=e,Object.setPrototypeOf(this,E.prototype)}}function d(t,e,n){return new E(t,e,n)}const $="ERR_METHOD_UNSUPPORTED",k="ERR_METHOD_PARAMETER_UNSUPPORTED",q="ERR_UNKNOWN_ENV",G="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",H="ERR_TIMED_OUT",j="ERR_UNEXPECTED_TYPE",N="ERR_PARSE",se="ERR_NAVIGATION_LIST_EMPTY",ae="ERR_NAVIGATION_CURSOR_INVALID",ce="ERR_NAVIGATION_ITEM_INVALID",ue="ERR_SSR_INIT",pe="ERR_INVALID_PATH_BASE";function w(){return d(j,"Value has unexpected type")}class v{constructor(e,n,r){this.parser=e,this.isOptional=n,this.type=r}parse(e){if(!(this.isOptional&&e===void 0))try{return this.parser(e)}catch(n){throw d(N,`Unable to parse value${this.type?` as ${this.type}`:""}`,n)}}optional(){return this.isOptional=!0,this}}function b(t,e){return()=>new v(t,!1,e)}const h=b(t=>{if(typeof t=="boolean")return t;const e=String(t);if(e==="1"||e==="true")return!0;if(e==="0"||e==="false")return!1;throw w()},"boolean");function B(t,e){const n={};for(const r in t){const o=t[r];if(!o)continue;let s,u;if(typeof o=="function"||"parse"in o)s=r,u=typeof o=="function"?o:o.parse.bind(o);else{const{type:c}=o;s=o.from||r,u=typeof c=="function"?c:c.parse.bind(c)}try{const c=u(e(s));c!==void 0&&(n[r]=c)}catch(c){throw d(N,`Unable to parse field "${r}"`,c)}}return n}function I(t){let e=t;if(typeof e=="string"&&(e=JSON.parse(e)),typeof e!="object"||e===null||Array.isArray(e))throw w();return e}function _(t,e){return new v(n=>{const r=I(n);return B(t,o=>r[o])},!1,e)}const g=b(t=>{if(typeof t=="number")return t;if(typeof t=="string"){const e=Number(t);if(!Number.isNaN(e))return e}throw w()},"number");function _e(t){return/^#[\da-f]{6}$/i.test(t)}function fe(t){return/^#[\da-f]{3}$/i.test(t)}function le(t){const e=t.replace(/\s/g,"").toLowerCase();if(_e(e))return e;if(fe(e)){let r="#";for(let o=0;o<3;o+=1)r+=e[1+o].repeat(2);return r}const n=e.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||e.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${t}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const s=parseInt(o,10).toString(16);return r+(s.length===1?"0":"")+s},"#")}const a=b(t=>{if(typeof t=="string"||typeof t=="number")return t.toString();throw w()},"string"),K=b(t=>le(a().parse(t)),"rgb");function me(t){return _({eventType:a(),eventData:e=>e}).parse(t)}function de(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(t=>{delete window[t]})}function he(t,e){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:t,eventData:e}),source:window.parent}))}function be(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(t=>{let e=window;t.forEach((n,r,o)=>{if(r===o.length-1){e[n]=he;return}n in e||(e[n]={}),e=e[n]})})}const ge={clipboard_text_received:_({req_id:a(),data:t=>t===null?t:a().optional().parse(t)}),custom_method_invoked:_({req_id:a(),result:t=>t,error:a().optional()}),invoice_closed:_({slug:a(),status:a()}),phone_requested:_({status:a()}),popup_closed:{parse(t){return _({button_id:e=>e==null?void 0:a().parse(e)}).parse(t??{})}},qr_text_received:_({data:a().optional()}),theme_changed:_({theme_params:t=>{const e=K().optional();return Object.entries(I(t)).reduce((n,[r,o])=>(n[r]=e.parse(o),n),{})}}),viewport_changed:_({height:g(),width:t=>t==null?window.innerWidth:g().parse(t),is_state_stable:h(),is_expanded:h()}),write_access_requested:_({status:a()})};function Ee(){const t=new W,e=new W;e.subscribe(r=>{t.emit("event",{name:r.event,payload:r.args[0]})}),be();const[,n]=C(de,V("resize",()=>{e.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),V("message",r=>{if(r.source!==window.parent)return;let o;try{o=me(r.data)}catch{return}const{eventType:s,eventData:u}=o,c=ge[s];try{const p=c?c.parse(u):u;e.emit(...p?[s,p]:[s])}catch(p){A.error(`An error occurred processing the "${s}" event from the Telegram application. Please, file an issue here: https://github.com/Telegram-Mini-Apps/tma.js/issues/new/choose`,o,p)}}),()=>t.clear(),()=>e.clear());return[{on:e.on.bind(e),off:e.off.bind(e),subscribe(r){return t.on("event",r)},unsubscribe(r){t.off("event",r)},get count(){return e.count+t.count}},n]}const[we,ye]=f(t=>{const[e,n]=Ee(),r=e.off.bind(e);return e.off=(o,s)=>{const{count:u}=e;r(o,s),u&&!e.count&&t()},[e,n]},([,t])=>t());function R(){return we()[0]}function Re(t,e){R().off(t,e)}function T(t,e,n){return R().on(t,e,n)}function D(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Te(t,e){const n=t.split("."),r=e.split("."),o=Math.max(n.length,r.length);for(let s=0;s<o;s+=1){const u=parseInt(n[s]||"0",10),c=parseInt(r[s]||"0",10);if(u!==c)return u>c?1:-1}return 0}function m(t,e){return Te(t,e)<=0}function O(t,e,n){if(typeof n=="string"){if(t==="web_app_open_link"&&e==="try_instant_view")return m("6.4",n);if(t==="web_app_set_header_color"&&e==="color")return m("6.9",n)}switch(t){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return m("6.1",e);case"web_app_open_popup":return m("6.2",e);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return m("6.4",e);case"web_app_switch_inline_query":return m("6.7",e);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return m("6.9",e);case"web_app_setup_settings_button":return m("6.10",e);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return m("7.2",e);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(t)}}function Pe(t){return"external"in t&&D(t.external)&&"notify"in t.external&&typeof t.external.notify=="function"}function Y(t){return"TelegramWebviewProxy"in t&&D(t.TelegramWebviewProxy)&&"postEvent"in t.TelegramWebviewProxy&&typeof t.TelegramWebviewProxy.postEvent=="function"}function J(){try{return window.self!==window.top}catch{return!0}}let F="https://web.telegram.org";function Ae(t){F=t}function X(){return F}function y(t,e,n){let r={},o;e===void 0&&n===void 0?r={}:e!==void 0&&n!==void 0?(r=n,o=e):e!==void 0&&("targetOrigin"in e?r=e:o=e);const{targetOrigin:s=X()}=r;if(ie("Posting event:",o?{event:t,data:o}:{event:t}),J()){window.parent.postMessage(JSON.stringify({eventType:t,eventData:o}),s);return}if(Pe(window)){window.external.notify(JSON.stringify({eventType:t,eventData:o}));return}if(Y(window)){window.TelegramWebviewProxy.postEvent(t,JSON.stringify(o));return}throw d(q,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside of Telegram application environment.")}function Se(t){return(e,n)=>{if(!O(e,t))throw d($,`Method "${e}" is unsupported in Mini Apps version ${t}`);if(D(n)){let r;if(e==="web_app_open_link"&&"try_instant_view"in n?r="try_instant_view":e==="web_app_set_header_color"&&"color"in n&&(r="color"),r&&!O(e,r,t))throw d(k,`Parameter "${r}" of "${e}" method is unsupported in Mini Apps version ${t}`)}return y(e,n)}}function z(t){return({req_id:e})=>e===t}function Ne(t){return d(H,`Timeout reached: ${t}ms`)}function ve(t,e){return Promise.race([typeof t=="function"?t():t,new Promise((n,r)=>{setTimeout(()=>{r(Ne(e))},e)})])}async function M(t){let e;const n=new Promise(c=>{e=c}),{event:r,capture:o,timeout:s}=t,[,u]=C(...(Array.isArray(r)?r:[r]).map(c=>T(c,p=>(!o||o(p))&&e(p))));try{return(t.postEvent||y)(t.method,t.params),await(s?ve(n,s):n)}finally{u()}}async function Ie(t,e,n,r={}){const{result:o,error:s}=await M({...r,method:"web_app_invoke_custom_method",event:"custom_method_invoked",params:{method:t,params:e,req_id:n},capture:z(n)});if(s)throw d(G,s);return o}async function De(){if(Y(window))return!0;try{return await M({method:"web_app_request_theme",event:"theme_changed",timeout:100}),!0}catch{return!1}}function Z(t){return t instanceof E}function Oe(t,e){return Z(t)&&t.type===e}function Me(t=!0){const e=[T("reload_iframe",()=>{y("iframe_will_reload"),window.location.reload()})],n=()=>e.forEach(r=>r());if(t){const r=document.createElement("style");r.id="telegram-custom-styles",document.head.appendChild(r),e.push(T("set_custom_style",o=>{r.innerHTML=o}),()=>document.head.removeChild(r))}return y("iframe_ready",{reload_supported:!0}),n}const Ue=b(t=>t instanceof Date?t:new Date(g().parse(t)*1e3),"Date");function Q(t,e){return new v(n=>{if(typeof n!="string"&&!(n instanceof URLSearchParams))throw w();const r=typeof n=="string"?new URLSearchParams(n):n;return B(t,o=>{const s=r.get(o);return s===null?void 0:s})},!1,e)}const Le=_({id:g(),type:a(),title:a(),photoUrl:{type:a().optional(),from:"photo_url"},username:a().optional()},"Chat").optional(),x=_({addedToAttachmentMenu:{type:h().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:h().optional(),from:"allows_write_to_pm"},firstName:{type:a(),from:"first_name"},id:g(),isBot:{type:h().optional(),from:"is_bot"},isPremium:{type:h().optional(),from:"is_premium"},languageCode:{type:a().optional(),from:"language_code"},lastName:{type:a().optional(),from:"last_name"},photoUrl:{type:a().optional(),from:"photo_url"},username:a().optional()},"User").optional();function We(){return Q({authDate:{type:Ue(),from:"auth_date"},canSendAfter:{type:g().optional(),from:"can_send_after"},chat:Le,chatInstance:{type:a().optional(),from:"chat_instance"},chatType:{type:a().optional(),from:"chat_type"},hash:a(),queryId:{type:a().optional(),from:"query_id"},receiver:x,startParam:{type:a().optional(),from:"start_param"},user:x},"InitData")}function Ve(t){return t.replace(/_[a-z]/g,e=>e[1].toUpperCase())}function Ce(t){return t.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}const $e=b(t=>{const e=K().optional();return Object.entries(I(t)).reduce((n,[r,o])=>(n[Ve(r)]=e.parse(o),n),{})},"ThemeParams");function ee(t){return Q({botInline:{type:h().optional(),from:"tgWebAppBotInline"},initData:{type:We().optional(),from:"tgWebAppData"},initDataRaw:{type:a().optional(),from:"tgWebAppData"},platform:{type:a(),from:"tgWebAppPlatform"},showSettings:{type:h().optional(),from:"tgWebAppShowSettings"},startParam:{type:a().optional(),from:"tgWebAppStartParam"},themeParams:{type:$e(),from:"tgWebAppThemeParams"},version:{type:a(),from:"tgWebAppVersion"}}).parse(t)}function te(t){return ee(t.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function ke(){return te(window.location.href)}function qe(){return performance.getEntriesByType("navigation")[0]}function Ge(){const t=qe();if(!t)throw new Error("Unable to get first navigation entry.");return te(t.name)}function ne(t){return`tma.js/${t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}`}function He(t,e){sessionStorage.setItem(ne(t),JSON.stringify(e))}function je(t){const e=sessionStorage.getItem(ne(t));try{return e?JSON.parse(e):void 0}catch{}}function Be(){return ee(je("launchParams")||"")}function Ke(t){return JSON.stringify(Object.fromEntries(Object.entries(t).map(([e,n])=>[Ce(e),n])))}function Ye(t){const{initDataRaw:e,themeParams:n,platform:r,version:o,showSettings:s,startParam:u,botInline:c}=t,p=new URLSearchParams;return p.set("tgWebAppPlatform",r),p.set("tgWebAppThemeParams",Ke(n)),p.set("tgWebAppVersion",o),e&&p.set("tgWebAppData",e),u&&p.set("tgWebAppStartParam",u),typeof s=="boolean"&&p.set("tgWebAppShowSettings",s?"1":"0"),typeof c=="boolean"&&p.set("tgWebAppBotInline",c?"1":"0"),p.toString()}function Je(t){He("launchParams",Ye(t))}function Fe(){for(const t of[ke,Ge,Be])try{const e=t();return Je(e),e}catch{}throw new Error("Unable to retrieve launch parameters from any known source.")}return i.ERR_INVALID_PATH_BASE=pe,i.ERR_INVOKE_CUSTOM_METHOD_RESPONSE=G,i.ERR_METHOD_PARAMETER_UNSUPPORTED=k,i.ERR_METHOD_UNSUPPORTED=$,i.ERR_NAVIGATION_HISTORY_EMPTY=se,i.ERR_NAVIGATION_INDEX_INVALID=ae,i.ERR_NAVIGATION_ITEM_INVALID=ce,i.ERR_PARSE=N,i.ERR_SSR_INIT=ue,i.ERR_TIMED_OUT=H,i.ERR_UNEXPECTED_TYPE=j,i.ERR_UNKNOWN_ENV=q,i.SDKError=E,i.captureSameReq=z,i.createPostEvent=Se,i.initWeb=Me,i.invokeCustomMethod=Ie,i.isIframe=J,i.isSDKError=Z,i.isSDKErrorOfType=Oe,i.isTMA=De,i.off=Re,i.on=T,i.postEvent=y,i.request=M,i.retrieveLaunchParams=Fe,i.setDebug=oe,i.setTargetOrigin=Ae,i.subscribe=U,i.supports=O,i.targetOrigin=X,i.unsubscribe=l,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),i}({});
//# sourceMappingURL=index.low-level.iife.js.map
